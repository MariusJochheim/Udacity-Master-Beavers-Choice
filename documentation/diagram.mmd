flowchart LR

  %% ========= ACTORS =========
  Customer([Customer])

  %% ========= AGENTS =========
  subgraph Agents[Agent Team]
    Orchestrator["Orchestrator Agent<br/>(quote_request · order_request · status_snapshot)"]
    InventoryAgent["Inventory & Procurement Agent<br/>(inventory_procurement · inventory_snapshot)"]
    QuoteAgent["Quote Agent<br/>(prepare_quote)"]
    OrderAgent["Order Execution Agent<br/>(execute_order)"]
    FinanceAgent["Finance Agent<br/>(financial_snapshot)"]
  end

  %% ========= TOOLS / DATA =========
  subgraph Tools[Core Functions & Data]
    QuoteHistory["search_quote_history()<br/><span style='font-size:10px'>Price anchors</span>"]
    Procurement["compute_procurement_decision()<br/><span style='font-size:10px'>Uses get_stock_level() + get_supplier_delivery_date()</span>"]
    InventorySnapshot["get_all_inventory()<br/>get_stock_level()<br/><span style='font-size:10px'>Inventory snapshot</span>"]
    RecordTxn["record_transaction()<br/>create_transaction()<br/><span style='font-size:10px'>Persist sales/restocks</span>"]
    CashBalance["get_cash_balance()<br/><span style='font-size:10px'>Budget guardrail</span>"]
    DeliveryETA["get_supplier_delivery_date()<br/><span style='font-size:10px'>Customer ETA</span>"]
    FinReport["generate_financial_report()<br/><span style='font-size:10px'>Finance snapshot</span>"]
    DB[(SQLite DB:<br/>inventory,<br/>transactions,<br/>quote_requests,<br/>quotes)]
  end

  DB <--> QuoteHistory
  DB <--> Procurement
  DB <--> InventorySnapshot
  DB <--> RecordTxn
  DB <--> FinReport
  Procurement --> DeliveryETA

  %% ========= REQUEST HANDLING =========
  Customer -->|Request| Orchestrator
  Orchestrator -->|quote_request| QuoteAgent
  QuoteAgent -->|History anchors| QuoteHistory
  QuoteAgent -->|Availability check| InventoryAgent
  InventoryAgent -->|Procurement guidance| Procurement
  InventoryAgent -->|Inventory state| InventorySnapshot
  InventoryAgent -->|Delivery ETA| DeliveryETA
  QuoteAgent -->|Quote + availability| Orchestrator

  %% ========= ORDERING & FULFILLMENT =========
  Orchestrator -->|order_request| OrderAgent
  OrderAgent -->|Match item & stock| Procurement
  OrderAgent -->|Budget check| CashBalance
  OrderAgent -->|Record sale/restock| RecordTxn
  OrderAgent -->|Customer ETA| DeliveryETA

  %% ========= REPORTING =========
  Orchestrator -->|status_snapshot| FinanceAgent
  FinanceAgent --> FinReport
  FinanceAgent -->|Cash + inventory| CashBalance
  FinReport --> Orchestrator

  %% ========= RESPONSE =========
  Orchestrator -->|Quote / order confirmation| Customer
