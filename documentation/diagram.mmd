flowchart LR

  %% ========= ACTORS =========
  Customer([Customer])

  %% ========= AGENTS =========
  subgraph Agents[Agent Team]
    Orchestrator["Orchestrator Agent<br/>(quote_request · order_request · status_snapshot)"]
    InventoryAgent["Inventory & Procurement Agent<br/>(inventory_procurement · inventory_snapshot)"]
    QuoteAgent["Quote Agent<br/>(prepare_quote)"]
    OrderAgent["Order Execution Agent<br/>(execute_order)"]
    FinanceAgent["Finance Agent<br/>(financial_snapshot)"]
  end

  %% ========= TOOLS / DATA =========
  subgraph Tools[Core Functions & Data]
    QuoteHistory["recent_quote_history()"]
    Procurement["compute_procurement_decision()"]
    InventorySnapshot["get_all_inventory()<br/>get_stock_level()"]
    RecordTxn["record_transaction()<br/>create_transaction()"]
    DeliveryETA["get_supplier_delivery_date()"]
    FinReport["generate_financial_report()"]
    DB[(SQLite DB:<br/>inventory,<br/>transactions,<br/>quote_requests,<br/>quotes)]
  end

  DB <--> QuoteHistory
  DB <--> Procurement
  DB <--> InventorySnapshot
  DB <--> RecordTxn
  DB <--> FinReport
  Procurement --> DeliveryETA

  %% ========= REQUEST HANDLING =========
  Customer -->|Request| Orchestrator
  Orchestrator -->|quote_request| QuoteAgent
  QuoteAgent -->|History anchors| QuoteHistory
  QuoteAgent -->|Availability check| InventoryAgent
  InventoryAgent -->|Procurement guidance| Procurement
  InventoryAgent -->|Inventory state| InventorySnapshot
  InventoryAgent -->|Delivery ETA| DeliveryETA
  QuoteAgent -->|Quote + availability| Orchestrator

  %% ========= ORDERING & FULFILLMENT =========
  Orchestrator -->|order_request| OrderAgent
  OrderAgent -->|Match item & stock| Procurement
  OrderAgent -->|Record sale/restock| RecordTxn
  OrderAgent -->|Customer ETA| DeliveryETA

  %% ========= REPORTING =========
  Orchestrator -->|status_snapshot| FinanceAgent
  FinanceAgent --> FinReport
  FinReport --> Orchestrator

  %% ========= RESPONSE =========
  Orchestrator -->|Quote / order confirmation| Customer
